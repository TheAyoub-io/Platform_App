{% extends "base.html" %}
{% block content %}
<h1 data-i18n="recommendation.title">Get a Recommendation</h1>
<form id="recommendationForm">
    <div class="form-group">
        <label for="Age" data-i18n="recommendation.age">Age</label>
        <input type="number" class="form-control" id="Age" name="Age" required>
    </div>
    <div class="form-group">
        <label for="Budget" data-i18n="recommendation.budget">Budget</label>
        <input type="number" class="form-control" id="Budget" name="Budget" required>
    </div>
    <div class="form-group">
        <label for="Interet" data-i18n="recommendation.interest">Interest</label>
        <input type="text" class="form-control" id="Interet" name="Interet" required>
    </div>
    <div class="form-group">
        <label for="Duree" data-i18n="recommendation.duration">Duration (days)</label>
        <input type="number" class="form-control" id="Duree" name="Duree" required>
    </div>
    <div class="form-group">
        <label for="Climat" data-i18n="recommendation.climate">Climate</label>
        <input type="text" class="form-control" id="Climat" name="Climat" required>
    </div>
    <div class="form-group">
        <label for="Continent" data-i18n="recommendation.continent">Continent</label>
        <select class="form-control" id="Continent" name="Continent" required>
            {% for continent in continents %}
            <option value="{{ continent }}">{{ continent }}</option>
            {% endfor %}
        </select>
    </div>
    <div class="form-group">
        <label for="Type_Destination" data-i18n="recommendation.destination_type">Destination Type</label>
        <select class="form-control" id="Type_Destination" name="Type_Destination" required>
            {% for dest_type in destination_types %}
            <option value="{{ dest_type }}">{{ dest_type }}</option>
            {% endfor %}
        </select>
    </div>
    <button type="submit" class="btn btn-primary" data-i18n="recommendation.submit">Get Recommendation</button>
</form>

<div id="result" class="mt-4"></div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const token = localStorage.getItem('token');
    if (!token) {
        window.location.href = "/login";
        return;
    }

    document.getElementById('recommendationForm').addEventListener('submit', async function (e) {
        e.preventDefault();
        const formData = new FormData(this);
        const data = Object.fromEntries(formData.entries());
        data.Age = parseInt(data.Age);
        data.Budget = parseInt(data.Budget);
        data.Duree = parseInt(data.Duree);

        try {
            const response = await fetch('/recommend/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify(data)
            });

            if (!response.ok) {
                const errorResult = await response.json();
                throw new Error(errorResult.detail || 'Failed to get recommendation.');
            }

            const resultHtml = await response.text();
            document.getElementById('result').innerHTML = resultHtml;
        } catch (error) {
            document.getElementById('result').innerHTML = `<div class="alert alert-danger">${error.message}</div>`;
        }
    });
});
</script>
{% endblock %}
